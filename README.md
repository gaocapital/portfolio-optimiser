# Portfolio Optimisation – GAO Capital ASV Portfolio

## Overview
This repository contains a fully featured, basket‑aware optimiser for **GAO Capital’s ASV multi‑strategy portfolio**. It identifies an efficient allocation while enforcing concentration, correlation, and drawdown limits, and it can stress‑test robustness through Monte‑Carlo ensembles. The system is written for **Python 3.9+** and is executed via `SCRIPTS/__main__.py`.  

The code also supports a **fixed‑portfolio back‑testing mode** whereby all asset and/or basket weights are predefined, allowing you to evaluate a static allocation without invoking the optimiser.

---

## Key Features

### Optimisation Engine
- **Multi‑objective targeting** – optimise *return‑first* or *Sharpe‑first* while respecting user‑defined hurdles.
- **Basket‑aware fair‑share allocation** – overlapping assets are split proportionally across their non‑benchmark baskets.
- **Fixed constraints** – lock individual asset weights and/or basket weights before optimisation.

### Risk Controls
- **Drawdown control** – hard inequality constraint, soft exponential penalty, or both.
- **Penalties**  
  - *Correlation* – discourages high linear correlation with the SPY benchmark.  
  - *Concentration* – exponential costs for the largest single‑asset weight and the heaviest basket weight.

### Search Strategy
- **Multistart SLSQP** – multiple randomised restarts to avoid local minima.
- **Monte‑Carlo repeats** – independent runs with distinct seeds; aggregates average weights and diagnostics.

### Data Handling
- Robust CSV ingestion (ISO `YYYY‑MM‑DD` or `Mon‑YY`), automatic month‑end alignment, percentage cleaning.
- Flexible global window and explicit date‑exclusion ranges.
- Optional inclusion of SPY as an investable sleeve.

### Reporting
- Weights, basket allocations, annualised return/volatility, Sharpe, alpha/beta/correlation vs SPY, max drawdown.
- Equity curve and calendar‑year tables.
- Persistent monthly P/L written to `DATA/aggregated_portfolio_mtm_returns.csv`.

### Fixed Portfolio Back‑Testing Mode
If you pre‑define **all** weights using `FIXED_ALLOCS` and/or `FIXED_BASKET_ALLOCS` in the source code, the optimiser detects that no free weights remain and switches to static back‑testing:
1. Skips the optimisation routine entirely.
2. Generates the full diagnostic suite (return, Sharpe, drawdown, alpha/beta, etc.) for the fixed allocation.

This mode is ideal for mandate‑driven allocations or historical model portfolios.

---

## Repository Structure
```
DATA/
├── Portfolio_Optimisation_Royce_Revised.csv       # Primary monthly return feed (update this file with new months or funds)
└── aggregated_portfolio_mtm_returns.csv           # Auto‑generated by the optimiser

SCRIPTS/
└── __main__.py                                    # Entry‑point; invoke to run the optimiser
```
> **Important**  Always maintain the original column headings when you append new data to `Portfolio_Optimisation_Royce_Revised.csv`. Add new funds as new columns; add new months as new rows.

---

## Input Data Format
The optimiser expects percentage monthly returns stored in **`DATA/Portfolio_Optimisation_Royce_Revised.csv`** with a header column labelled `Date`.

| Date  | SPY | AAAP MAC | LCAO | Startar | … |
|-------|-----|----------|------|---------|---|
| Jan‑19 | 2.3% | 1.1% | 1.8% | 0.4% | … |
| Feb‑19 | 1.2% | 0.9% | 2.0% | 0.3% | … |
| … | … | … | … | … | … |

---

## Usage
### Method 1 – Interactive Execution in an IDE
Open `SCRIPTS/__main__.py` in your preferred IDE (e.g. Spyder, VS Code) and run the script directly. The configuration block at the top of the file lets you:
- Include or exclude individual funds.
- Toggle penalties and adjust their λ/*k* parameters.
- Modify date windows, target return/Sharpe hurdles, RNG seeds, etc.

### Method 2 – Command‑Line Execution
#### Quick Start
```bash
python -m SCRIPTS            # uses defaults defined in __main__.py
```

#### Customisation Example
```bash
python -m SCRIPTS \
    --pri_order sharpe_first \
    --target_return 0.20 \
    --target_sharpe 4.0 \
    --exclude 2020-03-01:2020-04-30 \
    --monte 50 \
    --n_restarts 10
```

#### Command‑Line Arguments
| Argument | Description | Default |
|----------|-------------|---------|
| `--file` | CSV path for monthly returns | `DATA/Portfolio_Optimisation_Royce_Revised.csv` |
| `--start_date` | Inclusive start of sample | `2020-01-01` |
| `--end_date` | Inclusive end of sample | `2025-06-01` |
| `--exclude` | Date ranges to exclude (repeatable) | *none* |
| `--pri_order` | `return_first` \| `sharpe_first` | `return_first` |
| `--target_return` | Annual return hurdle | `0.20` |
| `--target_sharpe` | Annual Sharpe hurdle | `2.5` |
| `--max_dd` | Maximum drawdown cap | `0.025` |
| `--no_dd_limit` | Disable hard drawdown constraint | *off* |
| `--no_dd_penalty` | Disable soft drawdown penalty | *off* |
| `--n_restarts` | SLSQP restart attempts | `10` |
| `--seed` | Base RNG seed | `420` |
| `--monte` | Monte‑Carlo repetitions | `0` (single run) |

---

## Output
Each run produces:
- Optimised (or fixed) asset‑weight table and fair‑share basket breakdown.
- Annualised performance statistics.
- Equity‑curve chart vs SPY.
- Calendar‑year and year‑to‑date return tables.
- In Monte‑Carlo mode, run‑averaged results.
- `DATA/aggregated_portfolio_mtm_returns.csv` containing the portfolio’s monthly returns.

---

## Dependencies
Install all required packages with:
```bash
pip install -r requirements.txt
```

---

## Additional Notes
- **Train/Test Split:** Always separate training and test data before optimising (e.g. train on data up to 2024, test on 2025 onwards).
- **Pruning Negligible Allocations:** After an initial optimisation, remove strategies receiving < 5 % weight and rerun to streamline allocations.
- **Alpha Orthogonality:** Use discretion to ensure selected strategies are orthogonal in their alpha streams (different markets, asset classes, underlyings, etc.).
- **Guideline Denominations:** Translate optimiser outputs into recommended allocations in 2.5 % increments, with a minimum sleeve of 5 %.
- **Missing History:** If a fund lacks historical data, regress its returns against a relevant index (e.g. S&P 500) to back‑fill a proxy series before inclusion.

---

## Author
Developed for GAO Capital by Royce Lim – <roycelim578@gmail.com>.

